{% load static %}
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SERVE.TIX - Pertandingan{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
    <style>body { font-family: 'DM Sans', sans-serif; }</style>
</head>
<body class="bg-gray-50">
    <nav class="bg-[#1E2C4F] shadow-lg border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="#" class="text-xl sm:text-2xl font-bold">
                        <span class="text-[#FDF4D9]">SERVE.</span>
                        <span class="text-[#F6CA50]">TIX</span>
                    </a>
                </div>
                
                <div class="flex items-center gap-4">
                    {% if user.is_staff %}
                    <button onclick="openDjangoFormModal('{% url 'match_create' %}')" 
                            class="bg-[#F6CA50] text-gray-800 px-4 py-2 rounded-lg hover:bg-yellow-400 font-medium text-sm sm:text-base">
                        Tambah Pertandingan
                    </button>
                    {% endif %}
                    
                    <!-- TOMBOL MASUK DOANG -->
                    <a href="#" class="bg-[#F6CA50] text-gray-800 px-4 py-2 rounded-lg hover:bg-yellow-400 font-medium text-sm sm:text-base">
                        Masuk
                    </a>
                </div>
            </div>
        </div>
    </nav>

    {% block content %}
    {% endblock %}

    <div id="modalContainer"></div>

    <footer class="bg-blue-950 text-white py-6 sm:py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col">
            <!-- SERVETIX - di atas -->
            <div class="flex items-center mb-2">
                <h2 class="text-xl sm:text-2xl font-bold">
                    <span class="text-[#FDF4D9]">SERVE.</span>
                    <span class="text-[#F6CA50]">TIX</span>
                </h2>
            </div>
            
            <!-- Copyright - di bawah -->
            <div class="text-sm sm:text-base text-gray-300">
                <p>Â© 2025 SERVETIX. All rights reserved.</p>
            </div>
        </div>
    </div>
</footer>

    <script>
    // SCRIPT TETAP SAMA
    window.modalFormURL = null;

    function getCookie(name) {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
            cookie = cookie.trim();
            if (cookie.startsWith(name + '=')) {
                return decodeURIComponent(cookie.substring(name.length + 1));
            }
        }
        return null;
    }

    async function openDjangoFormModal(url) {
        window.modalFormURL = url;
        try {
            const response = await fetch(url);
            const html = await response.text();
            
            document.getElementById('modalContainer').innerHTML = `
                <div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4" onclick="if(event.target === this) closeModal()">
                    <div class="bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                        ${html}
                    </div>
                </div>
            `;
        } catch (error) {
            alert('Error loading form');
            window.location.href = url;
        }
    }

    function closeModal() {
        document.getElementById('modalContainer').innerHTML = '';
        window.modalFormURL = null;
    }

    async function deleteMatch(url, button) {
        if (!confirm('Yakin hapus pertandingan?')) return;
        
        button.disabled = true;
        button.textContent = 'Menghapus...';
        
        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': getCookie('csrftoken'),
                },
            });
            
            const data = await response.json();
            if (data.success) {
                const card = button.closest('.bg-\\[linear-gradient\\]');
                card?.remove();
                window.location.reload();
            } else {
                alert('Gagal menghapus');
            }
        } catch (error) {
            alert('Network error');
        } finally {
            button.disabled = false;
            button.textContent = 'Delete';
        }
    }

    window.handleFormSubmit = async function(event) {
        event.preventDefault();
        const form = event.target;
        const formData = new FormData(form);
        const submitBtn = form.querySelector('button[type="submit"]');
        
        submitBtn.disabled = true;
        submitBtn.textContent = 'Menyimpan...';
        
        try {
            const response = await fetch(window.modalFormURL, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
                }
            });
            
            const data = await response.json();
            if (data.success) {
                closeModal();
                window.location.reload();
            } else {
                alert('Error: ' + JSON.stringify(data.errors));
            }
        } catch (error) {
            alert('Network error');
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Simpan';
        }
    };

    window.setupModalForm = function() {
        const form = document.getElementById('modalForm');
        if (form) form.onsubmit = window.handleFormSubmit;
    };

    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') closeModal();
    });
    </script>
</body>
</html>